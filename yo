--[[
    SCRIPT FAKE TRADE ADOPT ME (VISUEL CLIENT-SIDE UNIQUEMENT)
    Ce script crée une interface de contrôle pour simuler un trade.
    
    AUTEUR: Assistant Trae
    DATE: 2026-01-05
]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local TweenService = game:GetService("TweenService")

-- Configuration des chemins (Basé sur tes informations)
local PATHS = {
    TradeApp = "TradeApp",
    PartnerOfferBody = {"Frame", "NegotiationFrame", "Body", "PartnerOffer"},
    MyOfferBody = {"Frame", "NegotiationFrame", "Body", "MyOffer"},
    Header = {"Frame", "NegotiationFrame", "Header"},
    ConfirmationPartner = {"Frame", "ConfirmationFrame", "PartnerOffer"},
    ChatFrame = {"Frame", "NegotiationFrame", "ChatFrame"},
    SpectateFrame = {"Frame", "SpectateFrame"},
    NegotiationFrame = {"Frame", "NegotiationFrame"},
    
    -- METTRE LE CHEMIN DE LA NOTIF ICI (Confirmé par l'utilisateur: DialogApp)
    RequestNotificationGui = "DialogApp" 
}

-- Variables d'état
local fakeTradeInterface = nil
local fakeRequestInterface = nil
local currentPartnerName = "FakePartner123"

--------------------------------------------------------------------------------
-- 1. CRÉATION DU CONTROL PANEL (L'interface avec les boutons)
--------------------------------------------------------------------------------

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FakeTradeControlPanel"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 220, 0, 350)
MainFrame.Position = UDim2.new(0, 24, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 24)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
local Stroke = Instance.new("UIStroke")
Stroke.Thickness = 2
Stroke.Transparency = 0.2
Stroke.Color = Color3.fromRGB(120, 120, 200)
Stroke.Parent = MainFrame
local Grad = Instance.new("UIGradient")
Grad.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 40)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 10, 14))
})
Grad.Rotation = 90
Grad.Parent = MainFrame

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "FAKE TRADE PANEL"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(235, 240, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = MainFrame

-- Fonction utilitaire pour créer des boutons
local function createButton(name, text, layoutOrder, callback)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.Position = UDim2.new(0.05, 0, 0, 55 + (layoutOrder * 42))
    btn.BackgroundColor3 = Color3.fromRGB(60, 80, 255)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = MainFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn
    
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Input pour le nom du partenaire
local NameInput = Instance.new("TextBox")
NameInput.Name = "NameInput"
NameInput.Size = UDim2.new(0.9, 0, 0, 35)
NameInput.Position = UDim2.new(0.05, 0, 0, 45)
NameInput.PlaceholderText = "Nom du Partenaire..."
NameInput.Text = ""
NameInput.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
NameInput.TextColor3 = Color3.fromRGB(255, 255, 255)
NameInput.Parent = MainFrame
local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 6)
InputCorner.Parent = NameInput
local NameStroke = Instance.new("UIStroke")
NameStroke.Thickness = 1
NameStroke.Transparency = 0.4
NameStroke.Color = Color3.fromRGB(120, 120, 200)
NameStroke.Parent = NameInput

local function createPetCard(name, imageId, tags)
    local card = Instance.new("Frame")
    card.Name = "PetCard_" .. name
    card.Size = UDim2.new(0, 92, 0, 92)
    card.BackgroundColor3 = Color3.fromRGB(28, 28, 34)
    card.BorderSizePixel = 0
    local s = Instance.new("UIStroke")
    s.Thickness = 2
    s.Color = Color3.fromRGB(140, 140, 220)
    s.Transparency = 0.2
    s.Parent = card
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, 12)
    c.Parent = card
    local img = Instance.new("ImageLabel")
    img.Name = "Icon"
    img.Size = UDim2.new(1, -12, 1, -28)
    img.Position = UDim2.new(0, 6, 0, 6)
    img.BackgroundTransparency = 1
    img.Image = imageId or ""
    img.Parent = card
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -12, 0, 20)
    nameLabel.Position = UDim2.new(0, 6, 1, -24)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.fromRGB(235, 240, 255)
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextScaled = true
    nameLabel.Text = name
    nameLabel.Parent = card
    local tagBar = Instance.new("Frame")
    tagBar.Name = "Tags"
    tagBar.Size = UDim2.new(1, -12, 0, 18)
    tagBar.Position = UDim2.new(0, 6, 0, 6)
    tagBar.BackgroundTransparency = 1
    tagBar.Parent = card
    local x = 0
    for _, t in ipairs(tags or {}) do
        local tag = Instance.new("TextLabel")
        tag.Size = UDim2.new(0, 36, 1, 0)
        tag.Position = UDim2.new(0, x, 0, 0)
        tag.BackgroundColor3 = t.color
        tag.TextColor3 = Color3.fromRGB(255, 255, 255)
        tag.Font = Enum.Font.GothamBold
        tag.TextScaled = true
        tag.Text = t.text
        tag.BorderSizePixel = 0
        local tc = Instance.new("UICorner")
        tc.CornerRadius = UDim.new(0, 6)
        tc.Parent = tag
        tag.Parent = tagBar
        x = x + 40
    end
    return card
end

local function addPresetPetsToPartnerOffer()
    if not fakeTradeInterface then return end
    local partnerOfferFrame = findObjectByPath(fakeTradeInterface, PATHS.PartnerOfferBody)
    if not partnerOfferFrame then return end
    local tagsFR = {
        {text="F", color=Color3.fromRGB(0,180,255)},
        {text="R", color=Color3.fromRGB(0,200,120)}
    }
    local tagsNR = {
        {text="N", color=Color3.fromRGB(255,120,0)},
        {text="R", color=Color3.fromRGB(0,200,120)}
    }
    local tagsNR2 = {
        {text="N", color=Color3.fromRGB(255,120,0)},
        {text="R", color=Color3.fromRGB(0,200,120)}
    }
    local tagsR = {
        {text="R", color=Color3.fromRGB(0,200,120)}
    }
    local frost = createPetCard("Frost Dragon", "rbxassetid://", tagsFR)
    local cow = createPetCard("Cow", "rbxassetid://", tagsNR)
    local kanga = createPetCard("Kangaroo", "rbxassetid://", tagsNR2)
    local cryptid = createPetCard("Cryptid", "rbxassetid://", tagsR)
    frost.Parent = partnerOfferFrame
    cow.Parent = partnerOfferFrame
    kanga.Parent = partnerOfferFrame
    cryptid.Parent = partnerOfferFrame
end

local function markPartnerAccepted()
    if not fakeTradeInterface then return end
    local nf = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
    if not nf then return end
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 140, 0, 36)
    label.Position = UDim2.new(1, -150, 0, 8)
    label.Text = "Partner Accepted"
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.BackgroundColor3 = Color3.fromRGB(0,170,90)
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0,8)
    c.Parent = label
    label.Parent = nf
end

local function openTradeWithPreset(partnerName)
    local realTradeApp = PlayerGui:FindFirstChild(PATHS.TradeApp)
    if fakeTradeInterface then fakeTradeInterface:Destroy() end
    fakeTradeInterface = realTradeApp and realTradeApp:Clone() or Instance.new("ScreenGui")
    fakeTradeInterface.Name = "FakeTradeApp"
    fakeTradeInterface.Parent = PlayerGui
    if fakeTradeInterface.Enabled ~= nil then fakeTradeInterface.Enabled = true end
    local headerFrame = findObjectByPath(fakeTradeInterface, PATHS.Header)
    if headerFrame then
        local textLabel = headerFrame:FindFirstChild("PlayerName") or headerFrame:FindFirstChild("NameLabel") or headerFrame:FindFirstChild("TextLabel")
        if not textLabel then
            for _, child in ipairs(headerFrame:GetDescendants()) do
                if child:IsA("TextLabel") then textLabel = child break end
            end
        end
        if textLabel then textLabel.Text = partnerName end
    end
    local negotiationFrame = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
    if negotiationFrame then negotiationFrame.Visible = true end
    addPresetPetsToPartnerOffer()
    task.delay(5, function()
        markPartnerAccepted()
    end)
end

local function showModernRequestDialog(partnerName)
    local gui = Instance.new("ScreenGui")
    gui.Name = "ModernRequest"
    gui.Parent = PlayerGui
    gui.ResetOnSpawn = false
    local overlay = Instance.new("Frame")
    overlay.Size = UDim2.new(1,0,1,0)
    overlay.BackgroundColor3 = Color3.fromRGB(0,0,0)
    overlay.BackgroundTransparency = 0.35
    overlay.Parent = gui
    local box = Instance.new("Frame")
    box.Size = UDim2.new(0, 380, 0, 190)
    box.Position = UDim2.new(0.5, -190, 0.5, -95)
    box.BackgroundColor3 = Color3.fromRGB(18,18,22)
    box.Parent = overlay
    local bstroke = Instance.new("UIStroke")
    bstroke.Thickness = 2
    bstroke.Color = Color3.fromRGB(120,120,200)
    bstroke.Transparency = 0.2
    bstroke.Parent = box
    local bcorner = Instance.new("UICorner")
    bcorner.CornerRadius = UDim.new(0, 12)
    bcorner.Parent = box
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -24, 0, 40)
    title.Position = UDim2.new(0, 12, 0, 12)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(235,240,255)
    title.Font = Enum.Font.GothamBold
    title.TextScaled = true
    title.Text = partnerName .. " veut échanger avec toi"
    title.Parent = box
    local accept = Instance.new("TextButton")
    accept.Size = UDim2.new(0, 160, 0, 40)
    accept.Position = UDim2.new(0, 24, 1, -56)
    accept.BackgroundColor3 = Color3.fromRGB(60, 180, 100)
    accept.TextColor3 = Color3.fromRGB(255,255,255)
    accept.Font = Enum.Font.GothamBold
    accept.TextScaled = true
    accept.Text = "ACCEPTER"
    local ac = Instance.new("UICorner")
    ac.CornerRadius = UDim.new(0,10)
    ac.Parent = accept
    accept.Parent = box
    local decline = Instance.new("TextButton")
    decline.Size = UDim2.new(0, 160, 0, 40)
    decline.Position = UDim2.new(1, -184, 1, -56)
    decline.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
    decline.TextColor3 = Color3.fromRGB(255,255,255)
    decline.Font = Enum.Font.GothamBold
    decline.TextScaled = true
    decline.Text = "DECLINER"
    local dc = Instance.new("UICorner")
    dc.CornerRadius = UDim.new(0,10)
    dc.Parent = decline
    decline.Parent = box
    accept.MouseButton1Click:Connect(function()
        gui:Destroy()
        openTradeWithPreset(partnerName)
    end)
    decline.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)
end

--------------------------------------------------------------------------------
-- 2. LOGIQUE DU SCRIPT
--------------------------------------------------------------------------------

-- Fonction pour trouver un objet via un chemin (table de strings)
local function findObjectByPath(root, pathTable)
    local current = root
    for _, name in ipairs(pathTable) do
        if current then
            current = current:FindFirstChild(name)
        else
            return nil
        end
    end
    return current
end

-- 1. RECEVOIR UNE DEMANDE (SIMULATION)
createButton("ReceiveRequest", "Recevoir Demande", 1, function()
    -- Nom du partenaire
    currentPartnerName = NameInput.Text
    if currentPartnerName == "" then currentPartnerName = "FakePartner" end
    
    print("Simulation demande de: " .. currentPartnerName)
    
    -- TENTATIVE DE TROUVER LA VRAIE INTERFACE DE NOTIFICATION
    local realNotification = PlayerGui:FindFirstChild(PATHS.RequestNotificationGui)
    
    -- Si on ne trouve pas par nom direct, on cherche un candidat probable
    if not realNotification then
        for _, gui in ipairs(PlayerGui:GetChildren()) do
            if gui.Name == "DialogApp" or gui.Name == "NotificationApp" or gui.Name == "InteractionsApp" then
                realNotification = gui
                break
            end
        end
    end

    if realNotification then
        print("Vraie notification trouvée : " .. realNotification.Name)
        
        if fakeRequestInterface then fakeRequestInterface:Destroy() end
        
        -- STRATÉGIE D'ISOLATION MAXIMALE
        -- Au lieu de cloner tout "DialogApp" (qui contient trop de trucs),
        -- On crée un ScreenGui VIERGE et on y met SEULEMENT la frame "Dialog"
        
        -- 1. Créer le conteneur propre
        fakeRequestInterface = Instance.new("ScreenGui")
        fakeRequestInterface.Name = "FakeNotificationContainer"
        fakeRequestInterface.Parent = PlayerGui
        fakeRequestInterface.ResetOnSpawn = false
        
        -- 2. Trouver la frame "Dialog" originale
        local originalDialogFrame = realNotification:FindFirstChild("Dialog")
        
        if originalDialogFrame then
            -- 3. Cloner UNIQUEMENT la frame Dialog
            local dialogClone = originalDialogFrame:Clone()
            dialogClone.Parent = fakeRequestInterface
            dialogClone.Visible = true 
            
            -- STRATÉGIE "BEST CANDIDATE" (Candidat Unique)
            -- On ne veut afficher qu'UNE SEULE fenêtre de dialogue, celle qui ressemble le plus à une demande de trade.
            
            -- 1. On cache ABSOLUMENT TOUT récursivement au départ
            for _, d in ipairs(dialogClone:GetDescendants()) do
                if d:IsA("GuiObject") then d.Visible = false end
            end

            -- Helpers pour identifier les boutons
            local function isAccept(btn)
                local n = string.lower(btn.Name)
                local t = ""
                if btn:IsA("TextButton") then t = string.lower(btn.Text) end
                return string.find(n, "accept") 
                    or string.find(t, "accept") 
                    or string.find(t, "accepter") 
                    or string.find(t, "oui") 
                    or string.find(n, "confirm") 
                    or (btn:IsA("ImageButton") and string.find(n, "check")) 
                    or btn.BackgroundColor3.G > 0.6
            end
            
            local function isDecline(btn)
                local n = string.lower(btn.Name)
                local t = ""
                if btn:IsA("TextButton") then t = string.lower(btn.Text) end
                return string.find(n, "decline") 
                    or string.find(t, "decline") 
                    or string.find(t, "decliner") 
                    or string.find(t, "refus") 
                    or string.find(n, "cancel") 
                    or string.find(n, "close") 
                    or (btn:IsA("ImageButton") and string.find(n, "cross")) 
                    or btn.BackgroundColor3.R > 0.6
            end

            -- 2. RECHERCHE DES CANDIDATS (Frames contenant une paire Accepter + Refuser)
            local candidates = {}
            local checkedParents = {} -- Pour éviter les doublons
            
            -- Scoring pour choisir la bonne fenêtre de trade
            local function computeCandidateScore(frame)
                local score = 0
                for _, d in ipairs(frame:GetDescendants()) do
                    if d:IsA("TextLabel") then
                        local txt = string.lower(d.Text or "")
                        -- Mots clefs positifs (trade)
                        if string.find(txt, "trade") then score = score + 3 end
                        if string.find(txt, "échange") then score = score + 3 end
                        if string.find(txt, "demande") then score = score + 2 end
                        if string.find(txt, "request") then score = score + 2 end
                        if string.find(txt, "accepter") or string.find(txt, "accept") then score = score + 1 end
                        if string.find(txt, "décliner") or string.find(txt, "decline") then score = score + 1 end
                        -- Mots clefs négatifs (promo/shop)
                        if string.find(txt, "nice trade") then score = score - 4 end
                        if string.find(txt, "shop") then score = score - 3 end
                        if string.find(txt, "serveur") or string.find(txt, "server") then score = score - 3 end
                        if string.find(txt, "offer") or string.find(txt, "offre") then score = score - 2 end
                        if string.find(txt, "buy") or string.find(txt, "acheter") then score = score - 2 end
                    end
                    if d:IsA("GuiObject") then
                        local nm = string.lower(d.Name or "")
                        if string.find(nm, "shop") or string.find(nm, "store") then score = score - 2 end
                        if string.find(nm, "promo") then score = score - 2 end
                        if string.find(nm, "trade") then score = score + 1 end
                        if string.find(nm, "dialog") then score = score + 1 end
                    end
                end
                return score
            end

            for _, desc in ipairs(dialogClone:GetDescendants()) do
                if (desc:IsA("TextButton") or desc:IsA("ImageButton")) and isAccept(desc) then
                    local parent = desc.Parent
                    if not checkedParents[parent] then
                        checkedParents[parent] = true
                        
                        -- Chercher un frère "Refuser"
                        local hasDecline = false
                        for _, sibling in ipairs(parent:GetChildren()) do
                            if (sibling:IsA("TextButton") or sibling:IsA("ImageButton")) and isDecline(sibling) then
                                hasDecline = true
                                break
                            end
                        end
                        
                        if hasDecline then
                            table.insert(candidates, parent)
                        end
                    end
                end
            end

            -- 3. SÉLECTION DU MEILLEUR CANDIDAT
            local bestFrame = nil
            
            -- Sélection basée sur le score
            local bestScore = -math.huge
            for _, frame in ipairs(candidates) do
                local s = computeCandidateScore(frame)
                if s > bestScore then
                    bestScore = s
                    bestFrame = frame
                end
            end

            -- 4. RÉVÉLATION ET CONFIGURATION DU GAGNANT
            local foundText = false
            local foundAccept = false
            local foundDecline = false

            if bestFrame then
                print("Meilleure frame trouvée : " .. bestFrame:GetFullName())
                
                for _, s in ipairs(dialogClone:GetDescendants()) do
                    if s:IsA("LocalScript") then s:Destroy() end
                end
                
                local allowed = {}
                allowed[bestFrame] = true
                for _, d in ipairs(bestFrame:GetDescendants()) do allowed[d] = true end
                local p = bestFrame.Parent
                while p and p ~= fakeRequestInterface do
                    allowed[p] = true
                    p = p.Parent
                end
                for _, d in ipairs(dialogClone:GetDescendants()) do
                    if d:IsA("GuiObject") then
                        d.Visible = not not allowed[d]
                    end
                end
                
                for _, child in ipairs(bestFrame:GetDescendants()) do
                    if child:IsA("TextLabel") then
                        if string.len(child.Text) > 0 and (string.find(string.lower(child.Name), "message") or string.find(string.lower(child.Name), "title") or string.find(string.lower(child.Name), "text")) then
                            child.Text = currentPartnerName .. " veut échanger avec toi !"
                            foundText = true
                        end
                    end
                    if child:IsA("TextButton") or child:IsA("ImageButton") then
                        if isAccept(child) then
                            foundAccept = true
                            if child:IsA("TextButton") then child.Text = "ACCEPTER" end
                            child.MouseButton1Click:Connect(function()
                                fakeRequestInterface:Destroy()
                                local realTradeApp = PlayerGui:FindFirstChild(PATHS.TradeApp)
                                if fakeTradeInterface then fakeTradeInterface:Destroy() end
                                fakeTradeInterface = realTradeApp:Clone()
                                fakeTradeInterface.Name = "FakeTradeApp"
                                fakeTradeInterface.Parent = PlayerGui
                                fakeTradeInterface.Enabled = true 
                                local headerFrame = findObjectByPath(fakeTradeInterface, PATHS.Header)
                                if headerFrame then
                                    local textLabel = headerFrame:FindFirstChild("PlayerName") or headerFrame:FindFirstChild("NameLabel") or headerFrame:FindFirstChild("TextLabel")
                                    if not textLabel then
                                        for _, c in ipairs(headerFrame:GetDescendants()) do
                                            if c:IsA("TextLabel") then textLabel = c break end
                                        end
                                    end
                                    if textLabel then textLabel.Text = currentPartnerName end
                                end
                                local negotiationFrame = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
                                if negotiationFrame then negotiationFrame.Visible = true end
                            end)
                        elseif isDecline(child) then
                            foundDecline = true
                            if child:IsA("TextButton") then child.Text = "DECLINER" end
                            child.MouseButton1Click:Connect(function()
                                fakeRequestInterface:Destroy()
                            end)
                        end
                    end
                end
            else
                warn("Aucune paire de boutons trouvée. Fallback total.")
            end
 
             -- 3. FALLBACK : SI RIEN TROUVÉ, ON NETTOIE ET ON INJECTE
             -- Si on a trouvé des boutons mais pas le texte, on injecte juste le texte
             -- Si on a rien trouvé, on injecte tout
             
             local targetParent = bestFrame or dialogClone -- Où injecter ? Dans la frame trouvée ou à la racine

             if not foundText then
                 print("Injection Texte de secours...")
                 local label = Instance.new("TextLabel")
                 label.Name = "InjectedText"
                 label.Text = currentPartnerName .. " veut échanger avec toi !"
                 label.Size = UDim2.new(0.9, 0, 0.4, 0)
                 label.Position = UDim2.new(0.05, 0, 0.1, 0)
                 label.BackgroundTransparency = 1
                 label.TextColor3 = Color3.fromRGB(0, 0, 0) -- Texte noir sur fond blanc probable
                 label.TextScaled = true
                 label.Font = Enum.Font.GothamBold
                 label.Parent = dialogClone
                 label.ZIndex = 10 -- Au dessus de tout
             end
 
             if not foundAccept then
                 print("Injection Bouton Accepter de secours...")
                 local btn = Instance.new("TextButton")
                 btn.Name = "InjectedAccept"
                 btn.Text = "ACCEPTER"
                 btn.Size = UDim2.new(0.4, 0, 0.2, 0)
                 btn.Position = UDim2.new(0.05, 0, 0.6, 0)
                 btn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
                 btn.TextColor3 = Color3.fromRGB(255, 255, 255)
                 btn.Font = Enum.Font.GothamBold
                 btn.Parent = dialogClone
                 btn.ZIndex = 10
                 
                 btn.MouseButton1Click:Connect(function()
                     fakeRequestInterface:Destroy()
                     -- LANCER LE VRAI TRADE
                     local realTradeApp = PlayerGui:FindFirstChild(PATHS.TradeApp)
                     if fakeTradeInterface then fakeTradeInterface:Destroy() end
                     fakeTradeInterface = realTradeApp:Clone()
                     fakeTradeInterface.Name = "FakeTradeApp"
                     fakeTradeInterface.Parent = PlayerGui
                     fakeTradeInterface.Enabled = true 
                     local headerFrame = findObjectByPath(fakeTradeInterface, PATHS.Header)
                     if headerFrame then
                         local textLabel = headerFrame:FindFirstChild("PlayerName") or headerFrame:FindFirstChild("NameLabel") or headerFrame:FindFirstChild("TextLabel")
                         if not textLabel then
                              for _, child in ipairs(headerFrame:GetDescendants()) do
                                  if child:IsA("TextLabel") then textLabel = child break end
                              end
                         end
                         if textLabel then textLabel.Text = currentPartnerName end
                     end
                     local negotiationFrame = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
                     if negotiationFrame then negotiationFrame.Visible = true end
                 end)
             end
             
            if not foundDecline then
                print("Injection Bouton Refuser de secours...")
                local btn = Instance.new("TextButton")
                btn.Name = "InjectedDecline"
                btn.Text = "DECLINER"
                btn.Size = UDim2.new(0.4, 0, 0.2, 0)
                btn.Position = UDim2.new(0.55, 0, 0.6, 0)
                btn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
                btn.TextColor3 = Color3.fromRGB(255, 255, 255)
                btn.Font = Enum.Font.GothamBold
                 btn.Parent = dialogClone
                 btn.ZIndex = 10
                 
                 btn.MouseButton1Click:Connect(function()
                     fakeRequestInterface:Destroy()
                 end)
             end
             
             -- Plus besoin de réactiver, c'est déjà fait

         else
             warn("Frame 'Dialog' introuvable dans DialogApp. Affichage de tout (fallback).")
             -- Si on trouve pas "Dialog", on remet tout visible (cas de secours)
             for _, child in ipairs(fakeRequestInterface:GetChildren()) do
                 if child:IsA("GuiObject") then child.Visible = true end
             end
             fakeRequestInterface.Enabled = true
         end
        
    else
        warn("Vraie notification introuvable. Utilisation de la version custom.")
        -- FALLBACK : Utiliser l'ancienne version custom si on ne trouve pas la vraie
        local fakeRequestGui = Instance.new("ScreenGui")
        -- ... (Code fallback identique à avant, je le remets pour sécurité)
        fakeRequestGui.Name = "FakeTradeRequest"
        fakeRequestGui.Parent = PlayerGui
        
        local reqFrame = Instance.new("Frame")
        reqFrame.Size = UDim2.new(0, 300, 0, 150)
        reqFrame.Position = UDim2.new(0.5, -150, 0.8, -75)
        reqFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        reqFrame.Parent = fakeRequestGui
        
        local reqText = Instance.new("TextLabel")
        reqText.Text = currentPartnerName .. " (VERSION CUSTOM - VRAIE UI NON TROUVÉE)"
        reqText.Size = UDim2.new(1, 0, 0.6, 0)
        reqText.TextColor3 = Color3.fromRGB(255, 255, 255)
        reqText.BackgroundTransparency = 1
        reqText.Parent = reqFrame
        
        local acceptBtn = Instance.new("TextButton")
        acceptBtn.Text = "ACCEPTER"
        acceptBtn.Size = UDim2.new(0.4, 0, 0.3, 0)
        acceptBtn.Position = UDim2.new(0.05, 0, 0.6, 0)
        acceptBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        acceptBtn.Parent = reqFrame
        
        acceptBtn.MouseButton1Click:Connect(function()
            fakeRequestGui:Destroy()
            -- Lancer Trade (Code dupliqué pour le fallback, c'est sale mais sûr)
            local realTradeApp = PlayerGui:FindFirstChild(PATHS.TradeApp)
            if fakeTradeInterface then fakeTradeInterface:Destroy() end
            fakeTradeInterface = realTradeApp:Clone()
            fakeTradeInterface.Parent = PlayerGui
            fakeTradeInterface.Enabled = true
            -- (Mise à jour nom simplifiée pour fallback)
            local negotiationFrame = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
            if negotiationFrame then negotiationFrame.Visible = true end
        end)
    end
end)

-- 2. AJOUTER UN FAUX PET (Visuel)
createButton("AddPet", "Ajouter Pet (Shadow Dragon)", 2, function()
    if not fakeTradeInterface then return end
    
    local partnerOfferFrame = findObjectByPath(fakeTradeInterface, PATHS.PartnerOfferBody)
    
    if partnerOfferFrame then
        -- On essaie de trouver un template de pet existant pour le cloner
        -- Souvent les jeux utilisent un "UIGridLayout". On crée une simple Frame si on ne trouve pas de template.
        
        local fakePet = Instance.new("ImageLabel")
        fakePet.Name = "FakePet"
        fakePet.Size = UDim2.new(0, 80, 0, 80) -- Taille arbitraire, sera gérée par le UIGridLayout s'il existe
        fakePet.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        fakePet.BorderSizePixel = 0
        
        -- Image ID pour un Shadow Dragon (Exemple, peut être changé)
        fakePet.Image = "rbxassetid://3614660863" -- Placeholder ID, à remplacer par un vrai ID de pet Adopt Me si connu
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = fakePet
        
        local label = Instance.new("TextLabel")
        label.Text = "Shadow Dragon"
        label.Size = UDim2.new(1, 0, 0, 20)
        label.Position = UDim2.new(0, 0, 1, -20)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.SourceSansBold
        label.TextStrokeTransparency = 0
        label.Parent = fakePet
        
        -- Ajouter le pet à l'offre du partenaire
        fakePet.Parent = partnerOfferFrame
        
        -- Si un Grid Layout existe, il placera l'objet automatiquement
    else
        warn("Impossible de trouver la frame PartnerOffer.")
    end
end)

-- 3. AJOUTER PET HIGH TIER (Exemple Mega Neon)
createButton("AddMegaPet", "Ajouter Mega Neon", 3, function()
    if not fakeTradeInterface then return end
    local partnerOfferFrame = findObjectByPath(fakeTradeInterface, PATHS.PartnerOfferBody)
    
    if partnerOfferFrame then
        local fakePet = Instance.new("ImageLabel")
        fakePet.Name = "FakeMegaPet"
        fakePet.Size = UDim2.new(0, 80, 0, 80)
        fakePet.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        fakePet.Image = "rbxassetid://10619069677" -- ID Exemple
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = fakePet
        
        -- Effet visuel "Mega" (Cycle de couleur simple)
        task.spawn(function()
            while fakePet.Parent do
                for i = 0, 1, 0.01 do
                    fakePet.BackgroundColor3 = Color3.fromHSV(i, 1, 1)
                    task.wait(0.05)
                end
            end
        end)
        
        fakePet.Parent = partnerOfferFrame
    end
end)

-- 4. AUTO ACCEPTER (Visuel)
createButton("PartnerAccept", "Partenaire: Accepter", 4, function()
    if not fakeTradeInterface then return end
    
    -- Il faut trouver le bouton ou l'indicateur de statut du partenaire
    -- Souvent c'est une barre de statut ou un changement de couleur
    
    local negotiationFrame = findObjectByPath(fakeTradeInterface, PATHS.NegotiationFrame)
    if negotiationFrame then
        -- Recherche générique d'indicateurs de statut
        -- Ceci est une supposition basée sur les interfaces standards
        local statusLabel = negotiationFrame:FindFirstChild("StatusLabel", true) 
                         or negotiationFrame:FindFirstChild("Timer", true)
        
        if statusLabel and statusLabel:IsA("TextLabel") then
            statusLabel.Text = "Accepted!"
            statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        end
        
        -- Simuler le passage à la frame de confirmation si nécessaire
        -- Note: Dans Adopt Me, il y a souvent une 2ème fenêtre (ConfirmationFrame)
        -- On peut simuler cela en cachant Negotiation et montrant Confirmation
        
        -- Créer un bouton pour switcher manuellement à la confirmation si besoin
        print("Visuel: Le partenaire a accepté.")
    end
end)

-- 5. FERMER LE SCRIPT
createButton("Close", "Fermer Menu", 5, function()
    ScreenGui:Destroy()
    if fakeTradeInterface then fakeTradeInterface:Destroy() end
end)

local function hideGalaxyScript()
    for _, gui in ipairs(PlayerGui:GetChildren()) do
        if gui:IsA("ScreenGui") then
            local n = string.lower(gui.Name or "")
            if gui ~= ScreenGui and n ~= string.lower(PATHS.TradeApp) and n ~= string.lower(PATHS.RequestNotificationGui) then
                local match = false
                if string.find(n, "shitty") or string.find(n, "galaxy") or string.find(n, "fake") then
                    match = true
                else
                    for _, d in ipairs(gui:GetDescendants()) do
                        if d:IsA("TextLabel") then
                            local t = string.lower(d.Text or "")
                            if string.find(t, "fake trade") or string.find(t, "shitty") or string.find(t, "nice trade") then
                                match = true
                                break
                            end
                        end
                    end
                end
                if match then
                    pcall(function()
                        if gui.Enabled ~= nil then gui.Enabled = false else gui.Visible = false end
                    end)
                end
            end
        end
    end
end

createButton("HideGalaxy", "Cacher script (GALAXY)", 6, function()
    hideGalaxyScript()
end)

createButton("OpenGalaxy", "Lancer script (GALAXY)", 7, function()
    local url = "https://raw.githubusercontent.com/GALAXYexecutor/projectleak/refs/heads/main/shittyfaketrade"
    local ok, res = pcall(function()
        return loadstring(game:HttpGet(url))()
    end)
    if not ok then
        warn("Impossible de lancer le script GALAXY: " .. tostring(res))
    end
end)

createButton("ReceiveAliloloaz", "Recevoir trade de Aliloloaz", 8, function()
    currentPartnerName = "Aliloloaz"
    showModernRequestDialog(currentPartnerName)
end)
